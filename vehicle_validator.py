# vehicle_validator.py
import re

class VehicleNumberValidator:
    """–í–∞–ª–∏–¥–∞—Ç–æ—Ä –Ω–æ–º–µ—Ä–æ–≤ –¢–°"""

    # –†–æ—Å—Å–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –≥–æ—Å –Ω–æ–º–µ—Ä–∞—Ö (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞, –∫—Ä–æ–º–µ –Å, –ô, –™, –´, –¨)
    VALID_RUSSIAN_LETTERS = "–ê–í–ï–ö–ú–ù–û–†–°–¢–£–•"

    # –õ–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –¥–ª—è –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö —Ç—Ä–∞–Ω—Å–ª–∏—Ç–æ–≤
    VALID_LATIN_LETTERS = "ABEKMHOPCTYX"

    # –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –±—É–∫–≤—ã
    VALID_LETTERS = VALID_RUSSIAN_LETTERS + VALID_LATIN_LETTERS

    # –¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏–∏ –ª–∞—Ç–∏–Ω–∏—Ü—ã –≤ –∫–∏—Ä–∏–ª–ª–∏—Ü—É
    TRANSLIT_MAP = {
        'A': '–ê', 'B': '–í', 'E': '–ï', 'K': '–ö', 'M': '–ú',
        'H': '–ù', 'O': '–û', 'P': '–†', 'C': '–°', 'T': '–¢',
        'Y': '–£', 'X': '–•'
    }

    @classmethod
    def normalize(cls, vehicle_number: str) -> str:
        """–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ –¢–°: –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –≤–µ—Ä—Ö–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É –∏ –∑–∞–º–µ–Ω–∞ –ª–∞—Ç–∏–Ω–∏—Ü—ã –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü—É"""
        if not vehicle_number:
            return vehicle_number

        # –ü—Ä–∏–≤–æ–¥–∏–º –∫ –≤–µ—Ä—Ö–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
        normalized = vehicle_number.strip().upper()

        # –ó–∞–º–µ–Ω—è–µ–º –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–µ
        result = []
        for char in normalized:
            result.append(cls.TRANSLIT_MAP.get(char, char))

        return ''.join(result)

    @classmethod
    def validate(cls, vehicle_number: str) -> tuple[bool, str]:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ –¢–° —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º –ø–æ—è—Å–Ω–µ–Ω–∏—è –æ—à–∏–±–∫–∏"""
        vehicle_number = vehicle_number.strip().upper()

        if not vehicle_number:
            return False, "‚ùå –ù–æ–º–µ—Ä –¢–° –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É –Ω–æ–º–µ—Ä–∞
        if len(vehicle_number) not in [8, 9]:
            return False, f"‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–æ–º–µ—Ä–∞: {len(vehicle_number)} —Å–∏–º–≤–æ–ª–æ–≤ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 8 –∏–ª–∏ 9)"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±—É–∫–≤–æ–π)
        first_char = vehicle_number[0]
        if first_char not in cls.VALID_LETTERS:
            return False, f"‚ùå –ü–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª '{first_char}' –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –¥–æ–ø—É—Å—Ç–∏–º–æ–π –±—É–∫–≤–æ–π. –î–æ–ø—É—Å—Ç–∏–º—ã–µ: {cls.VALID_RUSSIAN_LETTERS}"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–∏—Ñ—Ä—ã –≤ –ø–æ–∑–∏—Ü–∏—è—Ö 1-3
        for i in range(1, 4):
            if not vehicle_number[i].isdigit():
                return False, f"‚ùå –°–∏–º–≤–æ–ª '{vehicle_number[i]}' –≤ –ø–æ–∑–∏—Ü–∏–∏ {i+1} –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ü–∏—Ñ—Ä–æ–π"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±—É–∫–≤—ã –≤ –ø–æ–∑–∏—Ü–∏—è—Ö 4-5
        for i in range(4, 6):
            if vehicle_number[i] not in cls.VALID_LETTERS:
                return False, f"‚ùå –°–∏–º–≤–æ–ª '{vehicle_number[i]}' –≤ –ø–æ–∑–∏—Ü–∏–∏ {i+1} –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –¥–æ–ø—É—Å—Ç–∏–º–æ–π –±—É–∫–≤–æ–π. –î–æ–ø—É—Å—Ç–∏–º—ã–µ: {cls.VALID_RUSSIAN_LETTERS}"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ü–∏—Ñ—Ä—ã
        if len(vehicle_number) == 8:
            # –î–ª—è 8-—Å–∏–º–≤–æ–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —Å–∏–º–≤–æ–ª–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ü–∏—Ñ—Ä–∞–º–∏
            for i in range(6, 8):
                if not vehicle_number[i].isdigit():
                    return False, f"‚ùå –°–∏–º–≤–æ–ª '{vehicle_number[i]}' –≤ –ø–æ–∑–∏—Ü–∏–∏ {i+1} –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ü–∏—Ñ—Ä–æ–π"
        else:
            # –î–ª—è 9-—Å–∏–º–≤–æ–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–∏–º–≤–æ–ª–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ü–∏—Ñ—Ä–∞–º–∏
            for i in range(6, 9):
                if not vehicle_number[i].isdigit():
                    return False, f"‚ùå –°–∏–º–≤–æ–ª '{vehicle_number[i]}' –≤ –ø–æ–∑–∏—Ü–∏–∏ {i+1} –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ü–∏—Ñ—Ä–æ–π"

        return True, "‚úÖ –ù–æ–º–µ—Ä –¢–° –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω"

    @classmethod
    def get_valid_letters_info(cls) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –±—É–∫–≤–∞—Ö"""
        return (
            f"üìù –î–æ–ø—É—Å—Ç–∏–º—ã–µ –±—É–∫–≤—ã (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞):\n"
            f"{' '.join(cls.VALID_RUSSIAN_LETTERS)}\n\n"
            f"üìù –î–æ–ø—É—Å—Ç–∏–º—ã–µ –±—É–∫–≤—ã (–ª–∞—Ç–∏–Ω–∏—Ü–∞):\n"
            f"{' '.join(cls.VALID_LATIN_LETTERS)}"
        )

    @classmethod
    def get_examples(cls) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –Ω–æ–º–µ—Ä–æ–≤"""
        return (
            "üìå –ü—Ä–∏–º–µ—Ä—ã:\n"
            "‚Ä¢ –ê123–ë–í45 (8 —Å–∏–º–≤–æ–ª–æ–≤)\n"
            "‚Ä¢ –°456–î–ï789 (9 —Å–∏–º–≤–æ–ª–æ–≤)\n"
            "‚Ä¢ X789YZ123 (–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π)"
        )
